files:
  "/opt/elasticbeanstalk/hooks/appdeploy/post/99_monitoring_status.sh":
    mode: "000755"
    owner: root
    group: root
    content: |
      #!/bin/bash
      
      echo "=== 모니터링 설정 상태 확인 ==="
      
      # 노드 익스포터 상태 확인
      echo "노드 익스포터 상태:"
      docker ps -a | grep node-exporter
      
      # Pinpoint 에이전트 설치 확인
      echo "Pinpoint 에이전트 설치 상태:"
      if [ -d "/opt/pinpoint-agent" ]; then
        echo "설치됨: $(ls -la /opt/pinpoint-agent | wc -l) 파일"
        echo "Pinpoint 콜렉터 IP: $(grep 'profiler.collector.ip' /opt/pinpoint-agent/pinpoint-bootstrap.config)"
      else
        echo "설치되지 않음"
      fi
      
      # 애플리케이션 액추에이터 엔드포인트 확인
      echo "액추에이터 엔드포인트 상태:"
      curl -s http://localhost:8080/actuator/health | grep -q "UP" && echo "정상" || echo "오류"
      
      # JAVA_TOOL_OPTIONS 환경 변수 확인
      echo "JVM 옵션 설정:"
      printenv JAVA_TOOL_OPTIONS
      
      echo "=== 모니터링 설정 완료 ==="
      
      # 모니터링 서버에 연결 확인
      echo "모니터링 서버 연결 테스트:"
      if [ -n "$MONITORING_SERVER_IP" ]; then
        ping -c 1 $MONITORING_SERVER_IP && echo "연결 성공" || echo "연결 실패"
      else
        echo "모니터링 서버 IP가 설정되지 않음"
      fi 